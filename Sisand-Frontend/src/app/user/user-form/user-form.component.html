<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">{{ isEditMode ? 'Editar Usuário' : 'Novo Usuário' }}</h2>
        </div>
        <div class="card-body">

            <div *ngIf="successMessage" class="alert alert-success" role="alert">
                {{ successMessage }}
            </div>
            <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
                {{ errorMessage }}
            </div>

            <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
                
                <h4 class="mt-2 mb-3 border-bottom pb-1 text-primary">Acesso e Identificação</h4>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="username" class="form-label">Nome de Usuário <span class="text-danger">*</span></label>
                        <input type="text" id="username" formControlName="username" class="form-control"
                            [ngClass]="{'is-invalid': f['username'].invalid && (f['username'].touched || f['username'].dirty)}">
                            
                        <div *ngIf="f['username'].invalid && (f['username'].touched || f['username'].dirty)" class="invalid-feedback">
                            <div *ngIf="f['username'].errors?.['required']">
                                O nome de usuário é obrigatório.
                            </div>
                            <div *ngIf="f['username'].errors?.['serverError']">
                                {{ f['username'].errors?.['serverError'] }}
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" id="email" formControlName="email" class="form-control"
                            [ngClass]="{'is-invalid': f['email'].invalid && f['email'].touched}">
                        <div *ngIf="f['email'].invalid && f['email'].touched" class="invalid-feedback">
                            O email é obrigatório e deve ser válido.
                        </div>
                    </div>
                </div>

                <div class="mb-3" *ngIf="!isEditMode || f['password']">
                    <label for="password" class="form-label">
                        Senha <span *ngIf="!isEditMode" class="text-danger">*</span>
                        <span *ngIf="isEditMode" class="text-muted"></span>
                    </label>
                    <input type="password" id="password" formControlName="password" class="form-control"
                        [ngClass]="{'is-invalid': f['password'].invalid && f['password'].touched}">
                    <div *ngIf="f['password'].invalid && f['password'].touched" class="invalid-feedback">
                        A senha é obrigatória e deve ter pelo menos 6 caracteres.
                    </div>
                </div>
                
                <h4 class="mt-4 mb-3 border-bottom pb-1 text-primary">Dados Pessoais</h4>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="name" class="form-label">Nome Completo <span class="text-danger">*</span></label>
                        <input type="text" id="name" formControlName="name" class="form-control"
                            [ngClass]="{'is-invalid': f['name'].invalid && f['name'].touched}">
                        <div *ngIf="f['name'].invalid && f['name'].touched" class="invalid-feedback">
                            O nome completo é obrigatório.
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="cpf" class="form-label">CPF</label>
                        <input type="text" id="cpf" formControlName="cpf" class="form-control">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="phone" class="form-label">Telefone</label>
                        <input type="text" id="phone" formControlName="phone" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="dateOfBirth" class="form-label">Data de Nascimento</label>
                        <input type="date" id="dateOfBirth" formControlName="dateOfBirth" class="form-control"
                            [ngClass]="{'is-invalid': f['dateOfBirth'].invalid && f['dateOfBirth'].touched}">
                        
                        <div *ngIf="f['dateOfBirth'].invalid && f['dateOfBirth'].touched" class="invalid-feedback">
                            <div *ngIf="f['dateOfBirth'].errors?.['dateMustBeInPast']">
                                A data de nascimento deve ser anterior à data atual.
                            </div>
                        </div>
                    </div>
                </div>
                
                <h4 class="mt-4 mb-3 border-bottom pb-1 text-primary">Endereço</h4>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="cep" class="form-label">CEP <span class="text-danger">*</span></label>
                        <input 
                            type="text" 
                            id="cep" 
                            formControlName="cep" 
                            class="form-control"
                            [ngClass]="{'is-invalid': f['cep'].invalid && f['cep'].touched}">
                        
                        <div *ngIf="f['cep'].invalid && f['cep'].touched" class="invalid-feedback">
                            <div *ngIf="f['cep'].errors?.['required']">
                                O CEP é obrigatório.
                            </div>
                            <div *ngIf="f['cep'].errors?.['pattern']">
                                O formato do CEP é inválido (Ex: 00000-000).
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8 mb-3">
                        <label for="address" class="form-label">Endereço (Rua, Número, Complemento)</label>
                        <input type="text" id="address" formControlName="address" class="form-control">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="city" class="form-label">Cidade</label>
                        <input type="text" id="city" formControlName="city" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="state" class="form-label">Estado</label>
                        <input type="text" id="state" formControlName="state" class="form-control">
                    </div>
                </div>


                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="isAdmin" formControlName="isAdmin">
                            <label class="form-check-label" for="isAdmin">
                                Usuário Administrador
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6" *ngIf="isEditMode">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="status" formControlName="status">
                            <label class="form-check-label" for="status">
                                Usuário Ativo (Status)
                            </label>
                        </div>
                    </div>
                </div>


                <div class="d-flex justify-content-end mt-4">
                    <button type="submit" class="btn btn-success me-2" [disabled]="userForm.invalid">
                        <i class="bi bi-save"></i> {{ isEditMode ? 'Salvar Alterações' : 'Criar Usuário' }}
                    </button>
                    <button type="button" class="btn btn-outline-secondary" (click)="router.navigate(['/users'])">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>